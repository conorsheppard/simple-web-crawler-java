#!/bin/zsh

PROJECT_NAME="simple-web-crawler-java"
JAR_FILE="target/${PROJECT_NAME}-1.0-SNAPSHOT.jar"
MAIN_CLASS="com.conorsheppard.Application"

# Check if Maven build is needed
if [[ ! -f "$JAR_FILE" ]]; then
    echo "Building project with Maven..."
    mvn clean package || { echo "‚ùå Build failed!"; exit 1; }
fi

# Check if at least 1 argument (website URL) is provided
if [[ "$#" -lt 1 ]]; then
    echo "Usage: ./crawl.sh <website-url> [queue-type] [cache-type] [max-threads]"
    exit 1
fi

WEBSITE_URL="$1"
QUEUE_TYPE="${2:-ConcurrentQueue}"  # Default to ConcurrentQueue if not provided
CACHE_TYPE="${3:-ConcurrentCache}"  # Default to ConcurrentCache if not provided
MAX_THREADS="${4:-10}"              # Default to 10 threads if not provided

# Run the Java application
echo "üöÄ Running web crawler on $1"
mvn exec:java -Dexec.mainClass="$MAIN_CLASS" -Dexec.args="$WEBSITE_URL $QUEUE_TYPE $CACHE_TYPE $MAX_THREADS"
