#!/bin/zsh

PROJECT_NAME="simple-web-crawler-java"
JAR_FILE="target/${PROJECT_NAME}-1.0-SNAPSHOT.jar"

# Check if Maven build is needed
if [[ ! -f "$JAR_FILE" ]]; then
    echo "ğŸ“¦ Building project with Maven..."
    mvn clean package || { echo "âŒ Build failed!"; exit 1; }
fi

# Check if Kafka container is running and remove it
if docker ps -q -f name=kafka-web-crawler; then
    echo "ğŸ›‘ Kafka container is running. Stopping and removing it..."
    docker-compose down || { echo "âŒ Docker Compose down failed!"; exit 1; }
fi

# Start fresh Kafka and Redis containers with Docker Compose
echo "ğŸš€ Starting Kafka and Redis containers..."
docker-compose up -d || { echo "âŒ Docker Compose up failed!"; exit 1; }

# Run the crawler with the provided arguments
echo "ğŸš€ Running the crawler..."
java -jar "$JAR_FILE" "$@"
