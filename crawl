#!/bin/zsh

PROJECT_NAME="simple-web-crawler-java"
JAR_FILE="target/${PROJECT_NAME}-1.0-SNAPSHOT.jar"
MAIN_CLASS="com.conorsheppard.Application"

# Check if Maven build is needed
if [[ ! -f "$JAR_FILE" ]]; then
    echo "üîß Building project with Maven..."
    mvn clean package || { echo "‚ùå Build failed!"; exit 1; }
fi

# Default values
QUEUE_TYPE="concurrentQueue"  # Default queue type
CACHE_TYPE="inMemory"         # Default cache type
MAX_THREADS=30                # Default thread count

# If only one argument is passed, assume it's the URL
if [[ "$#" -eq 1 ]]; then
    WEBSITE_URL="$1"
else
    # Parse named arguments
    while [[ "$#" -gt 0 ]]; do
        case "$1" in
            --url) WEBSITE_URL="$2"; shift 2;;
            --queue) QUEUE_TYPE="$2"; shift 2;;
            --cache) CACHE_TYPE="$2"; shift 2;;
            --threads) MAX_THREADS="$2"; shift 2;;
            *) echo "‚ùå Unknown option: $1"; exit 1;;
        esac
    done
fi

# Ensure URL is set
if [[ -z "$WEBSITE_URL" ]]; then
    echo "‚ùå Error: No URL provided!"
    echo "Usage: ./crawl <website-url> OR ./crawl --url <website-url> [--queue <queue-type>] [--cache <cache-type>] [--threads <max-threads>]"
    exit 1
fi

# Run the Java application
echo "üöÄ Running web crawler on $WEBSITE_URL with:"
echo "   üèó Queue Type: $QUEUE_TYPE"
echo "   üóÑ Cache Type: $CACHE_TYPE"
echo "   üîÑ Max Threads: $MAX_THREADS"

mvn exec:java -Dexec.mainClass="$MAIN_CLASS" -Dexec.args="--url $WEBSITE_URL --queue $QUEUE_TYPE --cache $CACHE_TYPE --threads $MAX_THREADS"
